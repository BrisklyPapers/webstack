version: '2'
services:
  elasticsearch1:
    build: ./elasticsearch/
    container_name: elasticsearch1
    environment:
      - cluster.name=docker-cluster
      - bootstrap.memory_lock=true
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    ulimits:
      memlock:
        soft: -1
        hard: -1
    mem_limit: 1g
    volumes:
      - esdata1:/usr/share/elasticsearch/data
    ports:
      - 9200:9200
    networks:
      - esnet

  elasticsearch2:
    build: ./elasticsearch/
    container_name: elasticsearch2
    environment:
      - cluster.name=docker-cluster
      - bootstrap.memory_lock=true
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
      - "discovery.zen.ping.unicast.hosts=elasticsearch1"
    ulimits:
      memlock:
        soft: -1
        hard: -1
    mem_limit: 1g
    volumes:
      - esdata2:/usr/share/elasticsearch/data
    networks:
      - esnet

  mysql:
      image: mysql
      container_name: mysql
      environment:
          - MYSQL_ROOT_PASSWORD=root
          - MYSQL_DATABASE=briskly_papers
          - MYSQL_USER=briskly_papers
          - MYSQL_PASSWORD=briskly_papers
      volumes:
        - mysql_data:/var/lib/mysql
      networks:
        - laravelnet

  nginx:
      build:
        context: ./nginx
      container_name: nginx
      volumes:
        - ./php/src:/var/www
      ports:
        - 8085:80
      links:
        - app
        - mysql
        - elasticsearch1
        - elasticsearch2
      networks:
        - laravelnet

  app:
      build:
        context: ./php/docker
        dockerfile: app.docker
      container_name: app
      volumes:
        - ./php/src:/var/www
      networks:
        - esnet
        - laravelnet
      environment:
        - DB_HOST=mysql
        - DB_DATABASE=briskly_papers
        - DB_USERNAME=briskly_papers
        - DB_PASSWORD=briskly_papers

  react:
    build: ./react/
    container_name: react
    entrypoint: sh /home/node/entrypoint.sh
    working_dir: /home/node
    ports:
      - 3000:3000
    volumes:
      - ./react/:/home/node
    networks:
      - laravelnet

volumes:
  esdata1:
    driver: local
  esdata2:
    driver: local
  mysql_data:

networks:
  esnet:
  laravelnet: